<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSRP | Staff Dashboard</title>
    <style>
        :root {
            --primary-purple: #60068f;
            --glass: rgba(255, 255, 255, 0.05);
            --sidebar-bg: #0f0f0f;
            --bg-dark: #0a0a0a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }

        body {
            background: var(--bg-dark);
            color: #ffffff;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar Styling (Matches Info Page) */
        .sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            border-right: 1px solid #222;
            display: flex;
            flex-direction: column;
            padding: 40px 25px;
        }

        .sidebar h2 { 
            margin-bottom: 40px; 
            font-size: 1.4rem; 
            color: var(--primary-purple);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sidebar-btn {
            background: none;
            border: none;
            color: #888;
            text-align: left;
            padding: 14px 18px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: 0.2s;
            border-radius: 10px;
            margin-bottom: 8px;
            text-decoration: none;
            display: block;
        }

        .sidebar-btn:hover {
            color: white;
            background: rgba(255, 255, 255, 0.05);
        }

        .sidebar-btn.active {
            background: var(--primary-purple);
            color: white;
            box-shadow: 0 4px 12px rgba(96, 6, 143, 0.2);
        }

        .sidebar-btn.info-link {
            margin-top: auto; /* Pushes to bottom */
            color: var(--primary-purple);
            border: 1px solid rgba(96, 6, 143, 0.3);
        }

        /* Main Content Area */
        .content {
            flex-grow: 1;
            padding: 80px;
            overflow-y: auto;
            background: radial-gradient(circle at top right, #1a1a1a, #0a0a0a);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 50px;
        }

        h1 { font-size: 2.5rem; font-weight: 800; letter-spacing: -1px; }

        /* Glass Cards */
        .dashboard-card {
            background: var(--glass);
            border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            margin-bottom: 25px;
        }

        .dashboard-card h3 {
            color: var(--primary-purple);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .dashboard-card p {
            color: #b0b0b0;
            line-height: 1.6;
            font-size: 1.1rem;
        }

        .logout-btn {
            color: #ff4444;
            text-decoration: none;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 8px;
            background: rgba(255, 68, 68, 0.1);
            transition: 0.3s;
        }

        .logout-btn:hover {
            background: #ff4444;
            color: white;
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>MSRP Staff</h2>
        
        <a href="/dashboard" class="sidebar-btn active">Dashboard</a>
        <a href="/admin" class="sidebar-btn" id="admin-link" style="display: none;">Admin Panel</a>
        <a href="/documents" class="sidebar-btn">Documents</a>
        <a href="/settings" class="sidebar-btn">Account Settings</a>
        
        <a href="/" class="sidebar-btn info-link">‚Üê View Info Page</a>
    </div>

    <div class="content">
        <div class="header">
            <h1 id="welcome-text">Welcome, Staff</h1>
            <a href="/logout" class="logout-btn">Logout</a>
        </div>

        <div class="dashboard-card">
            <h3>Staff Notice Board</h3>
            <p>Welcome to the newly updated MSRP Staff Portal. Please ensure you are familiar with the updated server documents and the new registration flow. If you encounter any bugs, report them to the development team immediately.</p>
        </div>

        <div class="dashboard-card">
            <h3>Your Status</h3>
            <p id="user-role">Role: Fetching...</p>
        </div>
    </div>

    <script>
        // GATEKEEPER & DATA FETCH
        async function loadDashboard() {
            try {
                const response = await fetch('/api/check-auth');
                const data = await response.json();

                if (!data.loggedIn) {
                    window.location.href = '/login';
                } else {
                    // Update UI with Session Data
                    document.getElementById('welcome-text').innerText = `Welcome, ${data.username}`;
                    
                    // We need a separate fetch for role details if they aren't in check-auth
                    const userResponse = await fetch('/api/admin/users'); 
                    // Note: This works because we are the logged in user
                    const users = await userResponse.json();
                    const me = users.find(u => u.username === data.username);
                    
                    if (me) {
                        document.getElementById('user-role').innerText = `Role: ${me.role}`;
                        
                        // Show Admin Panel button if they are Admin+
                        if (['Admin', 'Management', 'Owner'].includes(me.role)) {
                            document.getElementById('admin-link').style.display = 'block';
                        }
                    }
                }
            } catch (err) {
                console.error("Dashboard error:", err);
            }
        }

        loadDashboard();
    </script>
</body>
</html>


